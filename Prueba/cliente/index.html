<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurante PEPS</title>
</head>

<body>

    <h2>Iniciar Sesión</h2>
    <form id="loginForm">
        Usuario: <input type="text" id="loginUsuario" required>
        Clave: <input type="password" id="loginClave" required>
        <button type="submit">Entrar</button>
    </form>

    <h2>Registrarse</h2>
    <form id="registerForm">
        Usuario: <input type="text" id="registerUsuario" required>
        Clave: <input type="password" id="registerClave" required>
        <button type="submit">Registrarse</button>
    </form>

    <h2>Cerrar Sesión</h2>
    <button id="logoutBtn">Cerrar Sesión</button>

    <h2>Subir Archivo</h2>
    <form id="uploadForm">
        <input type="file" id="fileInput" required>
        <button type="submit">Subir</button>
    </form>

    <h2>Archivos Subidos</h2>
    <button id="viewFiles">Ver Archivos</button>
    <ul id="fileList"></ul>

    <h2>Reservar Mesa</h2>
    <form id="reserveForm">
        Nombre Cliente: <input type="text" id="reservaNombre" required>
        Mesa Número: <input type="number" id="reservaMesa" required>
        Fecha: <input type="date" id="reservaFecha" required>
        Hora: <input type="time" id="reservaHora" required>
        <button type="submit">Reservar</button>
    </form>

    <h2>Calcular IVA</h2>
    <input type="number" id="monto" placeholder="Monto sin IVA">
    <button id="calcularIva">Calcular IVA</button>
    <p id="resultadoIva"></p>

    <script>
        const apiBase = "http://localhost:5000";  // Cambia esto si tu API está en otro lugar

        // Iniciar sesión
        document.getElementById("loginForm").onsubmit = async (e) => {
            e.preventDefault();
            const usuario = document.getElementById("loginUsuario").value;
            const clave = document.getElementById("loginClave").value;

            const res = await fetch(`${apiBase}/login`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ usuario, clave })
            });
            const data = await res.json();
            alert(data.message);
        };

        // Registrarse
        document.getElementById("registerForm").onsubmit = async (e) => {
            e.preventDefault();
            const usuario = document.getElementById("registerUsuario").value;
            const clave = document.getElementById("registerClave").value;

            const res = await fetch(`${apiBase}/register`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ usuario, clave })
            });
            const data = await res.json();
            alert(data.message);
        };

        // Cerrar sesión
        document.getElementById("logoutBtn").onclick = async () => {
            const res = await fetch(`${apiBase}/logout`, { method: "POST" });
            const data = await res.json();
            alert(data.message);
        };

        // Subir archivo
        document.getElementById("uploadForm").onsubmit = async (e) => {
            e.preventDefault();
            const fileInput = document.getElementById("fileInput").files[0];
            if (!fileInput) return alert("Selecciona un archivo");

            const formData = new FormData();
            formData.append("file", fileInput);

            const res = await fetch(`${apiBase}/upload`, {
                method: "POST",
                body: formData
            });
            const data = await res.json();
            alert(data.message);
        };

        // Ver archivos
        document.getElementById("viewFiles").onclick = async () => {
            const res = await fetch(`${apiBase}/files`);
            const files = await res.json();

            const fileList = document.getElementById("fileList");
            fileList.innerHTML = "";
            files.forEach(file => {
                const li = document.createElement("li");
                li.textContent = file;
                fileList.appendChild(li);
            });
        };

        // Reservar mesa
        document.getElementById("reserveForm").onsubmit = async (e) => {
            e.preventDefault();
            const nombre = document.getElementById("reservaNombre").value;
            const mesa = document.getElementById("reservaMesa").value;
            const fecha = document.getElementById("reservaFecha").value;
            const hora = document.getElementById("reservaHora").value;

            const res = await fetch(`${apiBase}/reservar`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ nombre, mesa, fecha, hora })
            });
            const data = await res.json();
            alert(data.message);
        };

        // Calcular IVA
        document.getElementById("calcularIva").onclick = () => {
            const monto = parseFloat(document.getElementById("monto").value);
            if (isNaN(monto) || monto < 0) {
                alert("Ingresa un monto válido");
                return;
            }
            const iva = monto * 0.21; // 21% de IVA
            document.getElementById("resultadoIva").textContent = `IVA: $${iva.toFixed(2)} - Total: $${(monto + iva).toFixed(2)}`;
        };
    </script>

</body>

</html>